<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-config/rafttfile">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">The .raftt File | Raftt Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.raftt.io/docs/config/rafttfile"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="The .raftt File | Raftt Docs"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="https://raftt-resources.s3.eu-central-1.amazonaws.com/docs/Logos/Favicon/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.raftt.io/docs/config/rafttfile"><link data-rh="true" rel="alternate" href="https://docs.raftt.io/docs/config/rafttfile" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.raftt.io/docs/config/rafttfile" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LD2K48WKPZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LD2K48WKPZ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.8dc580f8.css">
<link rel="preload" href="/assets/js/runtime~main.3708cc20.js" as="script">
<link rel="preload" href="/assets/js/main.8354005e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://raftt.io/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="https://raftt-resources.s3.eu-central-1.amazonaws.com/docs/Logos/Navbar/logo-dark.svg" alt="Raftt home" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://raftt-resources.s3.eu-central-1.amazonaws.com/docs/Logos/Navbar/logo-light.svg" alt="Raftt home" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro/raftt">Docs Home</a></div><div class="navbar__items navbar__items--right"><a href="https://join.slack.com/t/rafttcommunity/shared_invite/zt-196nlb5ra-rYPWEqQF~ETdgx9aqWANnw" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a href="https://raftt.io/" target="_blank" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_isFc"><img src="https://raftt-resources.s3.eu-central-1.amazonaws.com/docs/Logos/Navbar/logo-dark.svg" alt="Raftt home" class="themedImage_ToTc themedImage--light_HNdA"><img src="https://raftt-resources.s3.eu-central-1.amazonaws.com/docs/Logos/Navbar/logo-light.svg" alt="Raftt home" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/intro">Intro</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intro/raftt">Welcome to Raftt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/intro/how_raftt_works">How Raftt Works?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/basics">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basics/quickstart">Spawn Your First Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/basics/tutorial">Tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/config">Configuration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config/raftt.yml">raftt.yml</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/config/rafttfile">The .raftt File</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config/dev_container">Dev Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config/warmup">Warmup Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/config/db_seeding">Database Seeding</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/concepts">Key Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/git_workflows">Git Workflow Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/containers">Raftt&#x27;s Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/file_syncing">File Syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/concepts/port_map">Port Mapping</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/debugging">Debugging</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging/VSCode">VS Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/debugging/JetBrains">JetBrains IDEs</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli_reference">CLI Reference</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/config"><span itemprop="name">Configuration</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">The .raftt File</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>The .raftt File</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-is-a-raftt-file">What is a <code>.raftt</code> File<a href="#what-is-a-raftt-file" class="hash-link" aria-label="Direct link to what-is-a-raftt-file" title="Direct link to what-is-a-raftt-file">​</a></h3><p>A <code>.raftt</code> file is a file in which your Raftt environment is defined. It is written in <a href="https://github.com/bazelbuild/starlark" target="_blank" rel="noopener noreferrer">Starlark</a> - a python-like scripting language open-sourced by Google.</p><p>The <code>.raftt</code> is expected to be committed to your project’s repo and shared between all devs. Different repo branches may contain different <code>.raftt</code> files, which allows Raftt env definition to differ between branches.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configuring-the-raftt-file-in-rafttyml">Configuring the <code>.raftt</code> File in <code>raftt.yml</code><a href="#configuring-the-raftt-file-in-rafttyml" class="hash-link" aria-label="Direct link to configuring-the-raftt-file-in-rafttyml" title="Direct link to configuring-the-raftt-file-in-rafttyml">​</a></h3><p>The <code>envDefinition</code> field in the <code>raftt.yml</code> is used to configure the path to the <code>.raftt</code> file that defines the environment spawned by Raftt.</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># An example for a raftt.yml that spawns an env defined in example.raftt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">envDefinition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> acme.raftt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> admiral.acme.raftt.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">secrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="when-is-the-raftt-file-evaluated">When is the <code>.raftt</code> File Evaluated<a href="#when-is-the-raftt-file-evaluated" class="hash-link" aria-label="Direct link to when-is-the-raftt-file-evaluated" title="Direct link to when-is-the-raftt-file-evaluated">​</a></h3><p>The output of the interpretation of a <code>.raftt</code> file is a set of resource definitions to-be-deployed.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="on-raftt-up">On <code>raftt up</code><a href="#on-raftt-up" class="hash-link" aria-label="Direct link to on-raftt-up" title="Direct link to on-raftt-up">​</a></h4><p>What exactly <code>raftt up</code> does depends on the status of the environment for the current branch. The status of all your envs can be viewed using <a href="https://docs.raftt.io/docs/cli_reference#raftt-list" target="_blank" rel="noopener noreferrer"><code>raftt list</code></a>.
The <code>.raftt</code> file will be interpreted on <code>raftt up</code> only if the branch doesn’t have any existing env.
If the current branch has a <code>connected</code> env, <code>raftt up</code> connects to the env. If the env is <code>running</code>, <code>raftt up</code> connects to it and makes it <code>connected</code>, without modifying the env. If the env is <code>hibernated</code>, <code>raftt up</code> will wake it up (without re-interpreting the <code>.raftt</code> file).</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="on-raftt-rebuild">On <code>raftt rebuild</code><a href="#on-raftt-rebuild" class="hash-link" aria-label="Direct link to on-raftt-rebuild" title="Direct link to on-raftt-rebuild">​</a></h4><p>The <code>.raftt</code> file is interpreted on every <code>raftt rebuild</code>. The interpretation result is a set of resources. What happens with this set, depends on whether any resources were specified in the <code>raftt rebuild</code> command.
If you didn’t specify resources, all of the existing resources are taken down, and the output of the interpretation is deployed. If one or more resources were specified, any changes to these resources will be applied, and the rest will not change, even if the result of the interpretation differs from their current state.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-deploy-function">The <code>deploy()</code> Function<a href="#the-deploy-function" class="hash-link" aria-label="Direct link to the-deploy-function" title="Direct link to the-deploy-function">​</a></h3><p>The <code>deploy()</code> function receives a <a href="#resources"><code>Resources</code></a> object and adds the resources to the set of resources to-be-deployed when running <code>raftt up</code> or <code>rebuild</code>.</p><p><code>deploy()</code> can be called multiple times, each call adds the input resources to the previously added set. Trying to deploy a resource that shares the same type and name as a previously-deployed resource will result in an error. Resources of different types can share a name.  </p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_docker_compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./docker-compose.yml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data-types">Data Types<a href="#data-types" class="hash-link" aria-label="Direct link to Data Types" title="Direct link to Data Types">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="starlark-data-types">Starlark Data Types<a href="#starlark-data-types" class="hash-link" aria-label="Direct link to Starlark Data Types" title="Direct link to Starlark Data Types">​</a></h3><p>As the script in <code>.raftt</code> files is written in Starlark, all <a href="https://github.com/bazelbuild/starlark/blob/master/spec.md#data-types" target="_blank" rel="noopener noreferrer">Starlak data types</a> can be used in <code>.raftt</code> files.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h3><p>A <code>Resources</code> object contains several dicts, one for each supported resource type. The object types that are currently supported are pods, deployments, ingresses, services, and secrets (these are also the names of the <code>Resources</code> object attributes). If you need Raftt to support additional object types, join <a href="https://join.slack.com/t/rafttcommunity/shared_invite/zt-196nlb5ra-rYPWEqQF~ETdgx9aqWANnw" target="_blank" rel="noopener noreferrer">our community</a> or <a href="https://raftt.io/contact-us" target="_blank" rel="noopener noreferrer">contact us</a>, and we&#x27;ll be glad to look into it.</p><p>The keys in the dicts are the names of the resources, and the values are the objects that represent the resources themselves, as represented by Raftt.</p><p>When importing resource definitions (from a docker-compose file, Helm charts, or K8s manifests), the result is a <code>Resources</code> object.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Can also use Docker Compose and Helm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You can modify the imported resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map_port</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remote</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># These are the rest of the supported object types</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ingresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">configmaps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statefulsets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">namedvolumes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">crds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rolebindings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">serviceaccounts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="merging-resources-objects">Merging <code>Resources</code> Objects<a href="#merging-resources-objects" class="hash-link" aria-label="Direct link to merging-resources-objects" title="Direct link to merging-resources-objects">​</a></h4><p>Multiple <code>Resources</code> objects can be merged using the <code>+</code> operator. Note that the names must be unique - merging <code>Resources</code> objects that both have a resource of the same type and the same name will result in an error</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k8s_resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compose_resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_docker_compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./path/to/compose.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">all_resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_resources </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> compose_resources</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="defining-dependencies-between-resources">Defining dependencies between <code>Resources</code><a href="#defining-dependencies-between-resources" class="hash-link" aria-label="Direct link to defining-dependencies-between-resources" title="Direct link to defining-dependencies-between-resources">​</a></h4><p>A deployed resource can have dependencies on any other deployed workload.</p><p>Receives:</p><ul><li>A workload (must be either <code>Pod</code>, <code>Deployment</code> or <code>StatefulSet</code>)</li><li>Condition (optional) - the condition to wait on. Defaults to <code>service_started</code>, and can accpet any of:<ul><li><code>service_started</code></li><li><code>service_healthy</code></li><li><code>service_completed_successfully</code></li></ul></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">k8s_resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s-manifests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_pod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;db&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backend_pod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;backend&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backend_pod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_dependency</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backend_pod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_dependency</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> condition</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;service_healthy&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="repoworkingtree">RepoWorkingTree<a href="#repoworkingtree" class="hash-link" aria-label="Direct link to RepoWorkingTree" title="Direct link to RepoWorkingTree">​</a></h3><p>In multi-repo scenarios, you may need to access or reference a file that’s in a different repo from the current <code>.raftt</code> file. The handle to the other repo is an object called <code>RepoWorkingTree</code>.</p><p>To get this handle you need to either call <code>clone_repo_branch()</code> or <code>get_cloned_repo()</code>. See <a href="#multi-repo-support">here</a> for more details.</p><p>A subpath can be added to the <code>RepoWorkingTree</code> object using the <code>+</code> operator, to access specific files. This can as the file/folder path in functions that receive them as an argument.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Clone the repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clone_repo_branch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://github.com/rafttio/frontend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;main&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Mount the source code dir to one of the workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo_mount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> repo_volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/src&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo_mount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/app&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use it to build an image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">image_builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secondary_repo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dockerfile</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Dockerfile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="importing-resource-definitions">Importing Resource Definitions<a href="#importing-resource-definitions" class="hash-link" aria-label="Direct link to Importing Resource Definitions" title="Direct link to Importing Resource Definitions">​</a></h2><p>The resource definitions of the env can be imported in the <code>.raftt</code> file using standard formats - Docker Compose, K8s manifests, Helm charts or Kustomize. It is easy to support other formats or sources! <a href="https://raftt.io/contact-us" target="_blank" rel="noopener noreferrer">Contact us</a> and we&#x27;ll be glad to discuss.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="import-a-docker-compose-file">Import a Docker-compose File<a href="#import-a-docker-compose-file" class="hash-link" aria-label="Direct link to Import a Docker-compose File" title="Direct link to Import a Docker-compose File">​</a></h3><p>To import resources defined in a docker-compose file, use the <code>load_docker_compose()</code> function.
It receives the docker-compose file path and optionally the workdir and the docker-compose profiles. The profiles are passed as a list of profiles to be used.
The function returns a <a href="#resources"><code>Resources</code></a> object.
Docker-compose services are converted to Kubernetes pods.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">services </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_docker_compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./path/to/compose.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> profiles</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;gui&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="import-kubernetes-manifests">Import Kubernetes Manifests<a href="#import-kubernetes-manifests" class="hash-link" aria-label="Direct link to Import Kubernetes Manifests" title="Direct link to Import Kubernetes Manifests">​</a></h3><p>To import resources defined using raw Kubernetes manifests, use the <code>k8s_manifests()</code> function.<br>
<!-- -->It receives the path of a K8s manifest, or a directory of manifests. Note that only <code>.yml</code> and <code>.yaml</code> files are parsed.</p><p>The function returns a <a href="#resources"><code>Resources</code></a> object containing all the resources defined in the manifests.</p><p>The object types that are currently supported are pods, deployments, ingresses, services, configmaps, and secrets (these are also the names of the <code>Resources</code> object attributes). If you need Raftt to support additional object types, join <a href="https://join.slack.com/t/rafttcommunity/shared_invite/zt-196nlb5ra-rYPWEqQF~ETdgx9aqWANnw" target="_blank" rel="noopener noreferrer">our community</a> or <a href="https://raftt.io/contact-us" target="_blank" rel="noopener noreferrer">contact us</a>, and we&#x27;ll be glad to look into it.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources_from_directory </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Get manifests from a directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources_from_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests/pod.yml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Or a specific file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources_from_directory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources_from_file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="import-helm-charts">Import Helm Charts<a href="#import-helm-charts" class="hash-link" aria-label="Direct link to Import Helm Charts" title="Direct link to Import Helm Charts">​</a></h3><p>Raftt lets you use environment definitions defined in local Helm charts using the <code>helm_local_chart</code> function. Raftt will run helm with the <code>template</code> command and then load and return the generated resources identically to the <code>k8s_manifests</code> function.</p><p>Receives:</p><ul><li><p>Helm release name.</p></li><li><p>Path to chart (relative to repo root).</p></li><li><p>values_files (optional) - string / array of strings of the values files to use. These can be paths to files in the repo / URLs. Same as when using <code>helm template</code>, when passing multiple values files, the last one will override the previous files.</p></li><li><p>values (optional) - a dictionary of values to be passed to Helm. Will override values defined in the files.</p></li><li><p>version (optional) - the version of Helm to use.</p></li><li><p>Currently, <code>3.10.1</code> (default), <code>3.8.2</code> and <code>2.13.0</code> are supported. Supporting additional versions is easy - <a href="https://raftt.io/contact-us" target="_blank" rel="noopener noreferrer">contact us</a> if you need a different one.</p></li></ul><p>Returns: A <code>Resources</code> object containing all the resources defined in the manifests.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> helm_local_chart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chart-name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./helm/chart-path&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> values_files</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./helm/values.dev.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;3.8.2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> helm_local_chart</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;chart-name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./helm/chart-path&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> values_files</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;https://example.io/values.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./helm/values.dev.yml&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> values</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;serviceName&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;serv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;replicaCount&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ingressPort&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;3.8.2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="import-kustomize-files">Import Kustomize Files<a href="#import-kustomize-files" class="hash-link" aria-label="Direct link to Import Kustomize Files" title="Direct link to Import Kustomize Files">​</a></h3><p>To import resources defined with Kustomize, use the <code>kustomize_build()</code> function. Raftt will run Kustomize with the <code>build</code> command and then load and return the generated resources identically to the <code>k8s_manifests</code> function.</p><p>Receives:</p><ul><li><p>Path to kustomization directory</p></li><li><p>version (optional) - the version of Kustomize to use.</p></li><li><p>helm_version (optional) - the version of helm to use.</p></li><li><p>Currently, <code>4.5.7</code> (default) is supported. Supporting additional versions is easy - <a href="https://raftt.io/contact-us" target="_blank" rel="noopener noreferrer">contact us</a> if you need a different one.</p></li></ul><p>Returns: A <code>Resources</code> object containing all the resources defined in the manifests.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kustomize_build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./kustomize&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> kustomize_build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./kustomize&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;4.7.5&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> helm_version</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;3.10.1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Will print &quot;Resources&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="image-building">Image Building<a href="#image-building" class="hash-link" aria-label="Direct link to Image Building" title="Direct link to Image Building">​</a></h2><p>The docker images used in your environment can be defined in the <code>.raftt</code> file and built by Raftt. To define an image you wish to build, use the <code>build_image()</code> function.</p><p>The return value of <code>build_image()</code> can be assigned to a workload to set the image as the workload’s image. This will overwrite any previous definition of the workload image.</p><p><code>build_image()</code> receives:</p><ul><li>The ID to be used when referring to the image, e.g. in other Dockerfiles</li><li>The context for building the Dockerfile.</li><li><code>dockerfile</code> (optional, default is <code>CONTEXT/Dockerfile</code>) - The path of the Dockerfile. Equivalent to <code>--file</code> when using <code>docker build</code>.</li><li><code>args</code> (optional) - the arguments passed to Dockerfile. Similar to <code>--build-arg</code> when using <code>docker build</code>.</li><li><code>target</code> (optional) - Set the target build stage to build. Equivalent to <code>--target</code> when using <code>docker build</code>.</li><li><code>prebuild</code> (optional) - a command to run in the <code>dev</code> container before the image is built. It is passed as a string or an iterable of strings, e.g.<ul><li><code>prebuild=&quot;/path/to/script.sh&quot;</code></li><li><code>prebuild=[&quot;python3&quot;, &quot;-m&quot;, &quot;compileall&quot;, &quot;-f&quot;, &quot;app.py&quot;]</code></li></ul></li></ul><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">workload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">image_builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;web&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./docker/web/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dockerfile</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;./docker/web/Dockerfile&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;VERSION_ARG&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;latest&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;builder&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prebuild</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;python3&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-m&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;compileall&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-f&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;app.py&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="using-base-images">Using Base Images<a href="#using-base-images" class="hash-link" aria-label="Direct link to Using Base Images" title="Direct link to Using Base Images">​</a></h3><p>Sometimes you may wish to build images that aren’t intended to be directly used as the image of a workload, but instead to be used as a base image for other images. To do that you can call <code>build_image()</code> and use the ID to refer to the images in other Dockerfiles (in the <code>FROM</code> command).</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;raftt/base-python&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;./docker/python&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;raftt/base-web&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./docker/web/base-web/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dockerfile</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;./docker/web/base-web/Dockerfile&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;CONFIG_TYPE_ARG&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;config.DevelopmentConfig&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USERNAME_ARG&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nobody&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where we could use these images like this (note the references to the image in the <code>FROM</code> and the <code>copy --from</code>:</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM raftt/base-python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=raftt/base-web /some_file /some_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMAND bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="enhancing-and-modifying-the-resources">Enhancing and Modifying the Resources<a href="#enhancing-and-modifying-the-resources" class="hash-link" aria-label="Direct link to Enhancing and Modifying the Resources" title="Direct link to Enhancing and Modifying the Resources">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="modifying-the-environment-variables-of-a-workload">Modifying the Environment Variables of a Workload<a href="#modifying-the-environment-variables-of-a-workload" class="hash-link" aria-label="Direct link to Modifying the Environment Variables of a Workload" title="Direct link to Modifying the Environment Variables of a Workload">​</a></h3><p>There are two methods of modifying the environment variables of a workload (a Pod or a Deployment).</p><ul><li><code>set_env_vars</code>: Sets a Starlark dictionary as the environment variables</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>💡 The function overwrites ALL previously defined environment variables.</p></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_env_vars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;KEY&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VALUE&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>add_env_vars</code>: Update the environment variables with a Starlark dictionary</li></ul><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>💡 The function overwrites previously defined environment variables if any exists with the same name.</p></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_env_vars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;KEY&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;VALUE&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="setting-secrets">Setting Secrets<a href="#setting-secrets" class="hash-link" aria-label="Direct link to Setting Secrets" title="Direct link to Setting Secrets">​</a></h3><p>The commands to fetch the secrets are defined in the <code>raftt.yml</code> file (see our <a href="/docs/config/raftt.yml">docs</a>). This is because the commands are run on the local machine and the <code>.raftt</code> file is interpreted remotely, on the env controller.</p><p>In the <code>.raftt</code> file, the secrets can be used as variables or mounted to the workloads.</p><p>Local secrets can be fetched using the <code>get_secret()</code> function. The input for the function is the key used for the secret definition in the <code>raftt.yml</code> file, and the output is the secret value, as a string.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws_creds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_secret</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;aws-credentials&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># will return &quot;AKIAEXAMPLEAWSCREDS&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Mounting a secret to the workload is done using <a href="#volumes-and-mounts">volume mounts</a>, assuming the secret is defined with the attribute <code>outputvolume: true</code>.</p><p>Another method to define secrets, that isn’t related to the <code>.raftt</code> file is defining cluster secrets, that can be accessed from the envs. For more information, see our <a href="/docs/cli_reference#raftt-cluster-secrets">docs</a>. Cluster secrets can be mounted to workloads but are not available to the <code>get_secret</code> function.</p><p>There are few ways to define secrets for Raftt envs:</p><ul><li>Fetch secrets from the local machine. The commands to fetch these secrets are defined in the <code>raftt.yml</code> (see our <a href="/docs/config/raftt.yml">docs</a>). This is because the commands should run on the local machine and the <code>.raftt</code> file is interpreted remotely, on the env controller.</li><li>Cluster secrets accessible from all envs running on the private cluster. For more information, see our <a href="https://docs.raftt.io/docs/cli_reference#raftt-cluster-secrets" target="_blank" rel="noopener noreferrer">docs</a>.</li><li>Defining K8s <code>secret</code> objects by importing from a Helm chart or a K8s manifest.</li></ul><p>In the <code>.raftt</code> file, the secrets can be mounted to the workloads, using <a href="#volumes-and-mounts">volume mounts</a>, assuming the secret is defined with the attribute <code>outputvolume: true</code>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="volumes-and-mounts">Volumes and Mounts<a href="#volumes-and-mounts" class="hash-link" aria-label="Direct link to Volumes and Mounts" title="Direct link to Volumes and Mounts">​</a></h3><p>In the <code>.raftt</code> file, you can mount different kinds of volumes into the workloads. Defining these mounts provide various capabilities -</p><ul><li>Mounting a repo dir (synced with the local machine)</li><li>Mounting a volume (named or unnamed)</li><li>Mount a secret, defined in <code>raftt.yml</code> or as a cluster secret<ul><li>Mounting a secret defined using a Kubernetes manifest using the <code>.raftt</code> file is currently not supported.</li></ul></li><li>All mounts can be read-write (the default) or read-only, except for secrets that are always read-only.</li><li>Use the <code>init-on-rebuild</code> argument, available for volumes, to configure the volume to be re-initialized on every call to <code>raftt rebuild &lt;service&gt;.</code><ul><li>This is useful, for example, if the image being run already has node_modules and after rebuild we want to set the volume contents with the updated modules.</li></ul></li></ul><p>You first need to create a volume of any kind (if it’s a secret from <code>raftt.yml</code>, it’s already mounted) and then mount it to one or more workloads</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Repo volume - used commonly for syncing the source code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">repo_root </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> repo_volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod_a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">repo_root</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/code&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> read_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment_b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">repo_root</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subpath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./test_dir&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/tmp/test_dir&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Anonymous volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">anon_volume </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Anonymous, since no name was provided</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Named volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vol_foo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment_b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vol_foo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/etc/foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> read_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> init_on_rebuild</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod_a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vol_foo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/tmp/etc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> read_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> init_on_rebuild</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Secrets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Assuming `test-credentials` is defined in raftt.yml with `outputvolume: true`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod_a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secret_volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test-credentials&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/tmp/test_creds&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> read_only</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="port-mapping">Port Mapping<a href="#port-mapping" class="hash-link" aria-label="Direct link to Port Mapping" title="Direct link to Port Mapping">​</a></h3><p>Allows mapping workload ports into the local machine. Currently supports only specific ports, no random ports or port ranges.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">map_port</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remote</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="initializing-databases">Initializing Databases<a href="#initializing-databases" class="hash-link" aria-label="Direct link to Initializing Databases" title="Direct link to Initializing Databases">​</a></h3><p>Allows to define database initialization used for database seeding and by the <a href="/docs/cli_reference#raftt-data"><code>raftt data</code></a> commands (<code>seed</code>/<code>dump</code>/<code>save</code>/<code>load</code>) commands.</p><p>Raftt currently supports three types of initializers - two native initializers - for PostgreSQL and MongoDB, and a custom initializer using a script. For more information on data seeding, see our <a href="https://docs.raftt.io/docs/config/db_seeding" target="_blank" rel="noopener noreferrer">docs</a>.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">db_storage_vol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;db_storage&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Load from docker-compose, helm, or k8s manifests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_storage_vol </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">namedvolumes</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;db_storage&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_pod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;db&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use a native PostgreSQL initializer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># API: postgres_volume_initializer(workload, dump_file_path, user?, key_provider?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_storage_vol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> postgres_volume_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dump_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;dev_container/dump.sql&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;postgres&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use a native MongoDB initializer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># API: mongodb_volume_initializer(workload, dump_file_path, key_provider?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_storage_vol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mongodb_volume_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dump_file_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;dev_container/dump.archive&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use a custom initializer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># API: script_volume_initializer(workload, script, key_provider?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_storage_vol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> script_volume_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> script</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;bash seed_db.sh&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db_pod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db_storage_vol</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="directly-modifying-resources">Directly Modifying Resources<a href="#directly-modifying-resources" class="hash-link" aria-label="Direct link to Directly Modifying Resources" title="Direct link to Directly Modifying Resources">​</a></h3><p>You can modify some fields of loaded resources, as described in the example below.</p><p>More attributes will be editable in the future.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Load from docker-compose, helm, or k8s manifests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Editing metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## For pods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;baz&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;qux&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## For deployments - both the deployment and the template</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;deployment-annotation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;deployment-label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;template-annotation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;baz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;template-label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;qux&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">## For other resources - services, ingresses, secrets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ingresses</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;minimal-ingress&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ingress-label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;one&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ingresses</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;minimal-ingress&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ingress-annotation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;two&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;my-service&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;service-label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;three&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">services</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;my-service&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;service-annotation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;four&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">secrets</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;top-secret&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">labels</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;secret-label&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;five&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">secrets</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;top-secret&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metadata</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">annotations</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;secret-annotation&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;six&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Editing PodSpec and DeploymentSpec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hostname </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nginy&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hostname </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nginy-dep&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">replicas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Not supporting deploying multiple replicas, for now.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">working_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to/code&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/echo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;world&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">working_dir </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/path/to&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">command </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/echo&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">template</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">spec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">containers</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;world&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="defining-the-dev-container">Defining the <code>dev</code> container<a href="#defining-the-dev-container" class="hash-link" aria-label="Direct link to defining-the-dev-container" title="Direct link to defining-the-dev-container">​</a></h3><p>To define the dev container (see <a href="https://docs.raftt.io/docs/config/dev_container" target="_blank" rel="noopener noreferrer">docs</a>), call the function <code>deploy_dev_container()</code>.
The dev container is a workload that is imported using any of the supported resource definition methods (docker-compose / K8s manifest / Helm).
The imported definitions must include a single workload.</p><p>Example:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_docker_compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;./dev-container/dev_compose.yml&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy_dev_container</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A dev container must be defined exactly once. When deploying another <code>.raftt</code> file, in <a href="#multi-repo-support">multi-repo</a> scenarios, make sure that only one repo actually defines the dev container.</p><p>For backwards compatibility, the dev container can still be defined in <code>raftt.yml</code>. Defining a dev container both in <code>raftt.yml</code> and in the <code>.raftt</code> file, will result in an error.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="troubleshooting-the-raftt-file">Troubleshooting the <code>.raftt</code> File<a href="#troubleshooting-the-raftt-file" class="hash-link" aria-label="Direct link to troubleshooting-the-raftt-file" title="Direct link to troubleshooting-the-raftt-file">​</a></h2><p>When you write your <code>.raftt</code> file, like any other case of writing code, the result may differ from what you expected. To help you understand why that happens, use the <code>raftt config debug</code> command. Note that since the <code>.raftt</code> file interpretation happens in the remote env, for the <code>raftt config debug</code> command to work, you must have an active and connected env. To view your env status, use <a href="https://docs.raftt.io/docs/cli_reference#raftt-list" target="_blank" rel="noopener noreferrer"><code>raftt list</code></a>.</p><p>When you do that you get the dry-run results of interpreting the <code>.raftt</code> file. The file is fully interpreted but instead of deploying the changes to the env, it outputs the results of all the <code>print()</code> calls in the file. You can use this function to print any of the objects in the script.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./k8s_manifests/pod.yml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;nginx&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="viewing-the-resources-expected-to-be-deployed">Viewing the Resources Expected to be Deployed<a href="#viewing-the-resources-expected-to-be-deployed" class="hash-link" aria-label="Direct link to Viewing the Resources Expected to be Deployed" title="Direct link to Viewing the Resources Expected to be Deployed">​</a></h3><p>To view the “final result” of the <code>.raftt</code> file interpretation - the list of the resources that are expected to be deployed, run <code>raftt config debug</code> with the flag <code>--to-be-deployed</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multi-repo-support">Multi-repo Support<a href="#multi-repo-support" class="hash-link" aria-label="Direct link to Multi-repo Support" title="Direct link to Multi-repo Support">​</a></h2><p>Raftt lets you deploy environments whose code and definitions are held in multiple repositories.<br>
<!-- -->In this context, we have two kinds of repos -</p><ol><li>The <em>main</em> repo - the repo from which the user runs <code>raftt up</code>. The <code>.raftt</code> file of this repo is the one interpreted. This repo is automatically live-synced to the remote env.</li><li><em>Secondary</em> repos - repos that are loaded when explicitly requested in the <code>.raftt</code> file of a previously loaded repo. Such repos don’t automatically sync to the env, and don’t even have to be cloned locally.</li></ol><p>Whether a repo is considered <em>main</em> or <em>secondary</em> depends on the context of the specific <code>raftt up</code> executed - it’s not a characteristic of the repo itself.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cloning-secondary-repositories">Cloning Secondary Repositories<a href="#cloning-secondary-repositories" class="hash-link" aria-label="Direct link to Cloning Secondary Repositories" title="Direct link to Cloning Secondary Repositories">​</a></h3><p>For all multi-repo scenarios, you must get access to the secondary repo(s) from the context of the <code>.raftt</code> file. To do that you must first clone it using the <code>clone_repo_branch()</code> function. This function clones the repo into the environment, receiving a Git URL and a branch name. The command returns a <a href="#repoworkingtree"><code>RepoWorkingTree</code></a> object that can be used to access the repo files or to <a href="#the-deploy-function">deploy</a> the resources defined in it.</p><p>A subpath may be added to a <code>RepoWorkingTree</code> object using the <code>+</code> operator, in order to retrieve a sub-path inside the side repository. The operation results in a new <code>RepoWorkingTree</code>.</p><p>A repo can’t be cloned twice in the same environment with different branches, so make sure you don’t have contradicting branches in different <code>.raftt</code> files (see also the next section)</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Clone the repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clone_repo_branch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://github.com/rafttio/frontend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;main&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Mount the source code dir to one of the workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo_mount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> repo_volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo_mount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/app&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use it to build an image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">image_builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secondary_repo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dockerfile</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Dockerfile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="access-an-already-cloned-repo">Access an Already-cloned Repo<a href="#access-an-already-cloned-repo" class="hash-link" aria-label="Direct link to Access an Already-cloned Repo" title="Direct link to Access an Already-cloned Repo">​</a></h3><p>The <code>get_cloned_repo()</code> function is used to retrieve a<a href="#repoworkingtree"><code>RepoWorkingTree</code></a> object of a previously cloned Git repository. The function receives only the Git URL. This function helps you access the same repo from different <code>.raftt</code> files without worrying about having matching branches to prevent an error. The first <code>.raftt</code> file using the repo has to define the branch, and the others can get a handle to the cloned repo using this function</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Get a handle to the repo, assuming it was already cloned in another .raftt file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_cloned_repo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://github.com/rafttio/frontend&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Mount the source code dir to one of the workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo_mount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> repo_volume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">secondary_repo_mount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dst</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/app&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Use it to build an image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">image_builder </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> build_image</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;web&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secondary_repo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dockerfile</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Dockerfile&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="deploy-the-raftt-file-of-a-secondary-repo">Deploy the <code>.raftt</code> File of a Secondary Repo<a href="#deploy-the-raftt-file-of-a-secondary-repo" class="hash-link" aria-label="Direct link to deploy-the-raftt-file-of-a-secondary-repo" title="Direct link to deploy-the-raftt-file-of-a-secondary-repo">​</a></h3><p>In some cases, instead of accessing the secondary repo’s files and/or folders, as described in the previous sections, you may want to deploy all the resources defined in its <code>.raftt</code> file. For that purpose, you can use <a href="#repoworkingtree"><code>RepoWorkingTree</code></a>’s <code>deploy()</code> method.</p><p>This method only receives <code>config_args</code> as an input argument and does not return a value. It triggers the interpretation of the <code>.raftt</code> file defined in the secondary repo (as defined in its <code>raftt.yml</code>). The outcome of the interpretation is additional resources to be deployed to the env.</p><p>Note that different <code>.raftt</code> files are executed separately and have no access to one another’s objects.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clone_repo_branch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://github.com/rafttio/frontend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;main&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secondary_repo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config_args</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{&quot;profile&quot;: &quot;default&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="raftt-sync-command"><code>raftt sync</code> command<a href="#raftt-sync-command" class="hash-link" aria-label="Direct link to raftt-sync-command" title="Direct link to raftt-sync-command">​</a></h3><p>As mentioned <a href="#deploy-the-raftt-file-of-a-secondary-repo">above</a>, secondary repos do not have file syncing / hot reloading enabled by default, and they don’t even have to be cloned locally. If you want to start syncing the local state of a cloned secondary repo to the remote env, use the <code>raftt sync</code> command.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="branch-switching-in-synced-repos">Branch Switching in Synced Repos<a href="#branch-switching-in-synced-repos" class="hash-link" aria-label="Direct link to Branch Switching in Synced Repos" title="Direct link to Branch Switching in Synced Repos">​</a></h4><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="impact-on-raftt-rebuild-commands">Impact on <code>raftt rebuild</code> commands<a href="#impact-on-raftt-rebuild-commands" class="hash-link" aria-label="Direct link to impact-on-raftt-rebuild-commands" title="Direct link to impact-on-raftt-rebuild-commands">​</a></h4><p>Switching branches in the main repo creates a new Raftt env for the new branch, or switches to one if it already exists. When doing it in a synced secondary repo, the file changes happen in-place, without changing the env. The file changes are synced to the remote repo, and depends on the changes, you might want to run <code>raftt restart</code> or <code>raftt rebuild</code>.</p><p>When running <code>raftt rebuild</code>, the main and secondary <code>.raftt</code> files are re-interpreted. When rebuilding, the branches specified in <code>clone_repo_branch()</code> are ignored for synced repos - the current repo state is used.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="running-raftt-commands-from-the-context-of-synced-repo">Running Raftt Commands From the Context of Synced Repo<a href="#running-raftt-commands-from-the-context-of-synced-repo" class="hash-link" aria-label="Direct link to Running Raftt Commands From the Context of Synced Repo" title="Direct link to Running Raftt Commands From the Context of Synced Repo">​</a></h4><p>Currently, Raftt commands (<code>sh</code>, <code>logs</code>, <code>status</code>, ...) may only be run from the main repo from which the original <code>raftt up</code> was performed.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="local-configuration">Local Configuration<a href="#local-configuration" class="hash-link" aria-label="Direct link to Local Configuration" title="Direct link to Local Configuration">​</a></h2><p>In some cases, users may want to customize the environment created by <code>raftt up</code> or <code>raftt rebuild</code> without changing the <code>.raftt</code> file that’s committed to the repo. This can be done either by referring to the local environment variables from the <code>.raftt</code> file, or by running it with arguments.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="accessing-the-local-environment-variables">Accessing the Local Environment Variables<a href="#accessing-the-local-environment-variables" class="hash-link" aria-label="Direct link to Accessing the Local Environment Variables" title="Direct link to Accessing the Local Environment Variables">​</a></h3><p>Env variables from the host are available as a dict in <code>local.env</code>.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">env_var </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> local</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;MY_ENV_VAR&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="arguments">Arguments<a href="#arguments" class="hash-link" aria-label="Direct link to Arguments" title="Direct link to Arguments">​</a></h3><p>You can send arguments to <code>raftt up</code> and <code>raftt rebuild</code> commands that can be accessed from the <code>.raftt</code> file. The args can be received in the CLI using the <code>--config-args</code> option or to be read from a file using the <code>--config-args-file</code> option that receives the file path. The string value passed in the CLI or in the file contents can be accessed from the <code>.raftt</code> file using the <code>local.config_args</code> variable.</p><p>The input can be formatted in any format of your choice, but some formats have builtin parsers (see <a href="#jsonyaml-encodingdecoding">here</a>).</p><p>A common use-case for using arguments is stating which docker-compose profiles are to be deployed</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;encoding/json.star&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;json&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># This assumes args are a &quot;serialized&quot; json string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">config_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">profiles </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> input_args</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;compose_profiles&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">load_docker_compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./path/to/compose.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> profiles</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">profiles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="persistency-of-the-config-arguments">Persistency of the Config Arguments<a href="#persistency-of-the-config-arguments" class="hash-link" aria-label="Direct link to Persistency of the Config Arguments" title="Direct link to Persistency of the Config Arguments">​</a></h4><p>The <code>.raftt</code> file is interpreted on every <code>raftt rebuild</code>. Every interpretation potentially uses the <code>config_args</code> variable. To save the user from having to remember the <code>config_args</code> used for the running env, Raftt stores the last <code>config_args</code> used and uses the same string for future <code>raftt rebuild</code>s. If you want to change the <code>config_args</code> used, run <code>raftt rebuild</code> with <code>--config-args</code> or <code>--config-args-file</code>. The new args will overwrite the existing args, and will be used for the current rebuild and for future ones.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="jsonyaml-encodingdecoding">JSON/YAML Encoding/Decoding<a href="#jsonyaml-encodingdecoding" class="hash-link" aria-label="Direct link to JSON/YAML Encoding/Decoding" title="Direct link to JSON/YAML Encoding/Decoding">​</a></h2><p>If you wish to encode and/or decode JSON or YAML inside your <code>.raftt</code> file, you can do it by loading external modules using the <code>load()</code> function. The load function gets the module and the name symbol you wish to load. In the code snippet below you can see the exact syntax for loading the JSON and YAML libraries and using them.</p><p>Handling JSON and YAML can very handy in conjunction with <a href="#arguments">local.config_args</a>.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;encoding/json.star&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;json&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;encoding/yaml.star&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;yaml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Prints: {&quot;a&quot;:1,&quot;b&quot;:2}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yaml_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">      name: web</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">yaml</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loads</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">yaml_dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Prints: {&quot;apiVersion&quot;: &quot;apps/v1&quot;, &quot;kind&quot;: &quot;Deployment&quot;, &quot;metadata&quot;: {&quot;name&quot;: &quot;web&quot;}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For this functionality, Raftt uses <a href="https://github.com/qri-io/starlib" target="_blank" rel="noopener noreferrer">Starlib</a> - a community-driven project to bring a standard library to Starlark. It has additional features besides handling JSON and YAML. You can read about them and see usage documentation in their <a href="https://github.com/qri-io/starlib#readme" target="_blank" rel="noopener noreferrer">repo</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="file-watching">File Watching<a href="#file-watching" class="hash-link" aria-label="Direct link to File Watching" title="Direct link to File Watching">​</a></h2><p>This mechanism allows registering hooks that trigger actions when files that match a given glob patterns changed. The patterns must contain absolute paths, relative paths will raise an error.</p><p>When registering a hook you need to specify the following:</p><ul><li>One or more workloads to watch glob patterns for changed files - the <code>on</code> argument</li><li>One or more actions to perform when a file changes matching one of the glob patterns - the <code>do</code> argument</li></ul><p>Hooks registered with more than one action will execute the commands in order of definition.</p><p>The <code>actions.CMD</code> constructor creates a command type that receives a command to execute as a string or an iterable of strings and a workload to execute the command on</p><p>Common use-cases -</p><ul><li>Auto-install dependencies by watching files like <code>package.json</code> or <code>requirements.txt</code></li><li>Auto-build the code on file changes by watching the source code files, e.g. all the <code>*.ts</code> files in the relevant folders.</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="example-file">Example file<a href="#example-file" class="hash-link" aria-label="Direct link to Example file" title="Direct link to Example file">​</a></h3><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./test-manifests.yml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pods</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx_dep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx-dep&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Trigger npm install when package files change</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package_json_glob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/app/**/package.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">register_hook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    on</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnFileChanged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        patterns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_json_glob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnFileChanged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx_dep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        patterns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">package_json_glob</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    do</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CMD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;npm&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;install&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Trigger pip install when requirements.txt changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip_install </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;pip&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;install&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-r&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;requirements.txt&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">register_hook</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    on</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">OnFileChanged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx_dep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      patterns</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/root/requirements.txt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    do</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CMD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pip_install</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      actions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CMD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workload</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">nginx_dep</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pip_install</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">resources</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When the <code>requirements.txt</code> file changes on the <code>nginx_dep</code> workload, the command <code>pip install -r requirements.txt</code> is executed on the <code>nginx</code> pod and <code>nginx_dep</code> deployment.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="changing-the-hooks">Changing the Hooks<a href="#changing-the-hooks" class="hash-link" aria-label="Direct link to Changing the Hooks" title="Direct link to Changing the Hooks">​</a></h3><p>The hook is “controlled” by the workload that watches the glob patterns. It means that in order to apply changes to a hook, either a change in the watchers (the <code>on</code> clause) or in the actions (the <code>do</code> clause), the “watching” workload must be rebuilt. The “affected” workload (the one in which the action is performed) only needs to be rebuilt if the action is modified, not necessarily if the watcher was modified.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="viewing-the-hook-mechanism-logs">Viewing the Hook Mechanism Logs<a href="#viewing-the-hook-mechanism-logs" class="hash-link" aria-label="Direct link to Viewing the Hook Mechanism Logs" title="Direct link to Viewing the Hook Mechanism Logs">​</a></h3><p>The logs for the hooks, including the result of the actions, are <strong>not</strong> a part of the regular workload logs. To view the logs, run <code>raftt logs --hooks</code> with or without specifying service. If you don’t specify a service, you will view the full log of the hook mechanism.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="accessing-the-filesystem">Accessing the filesystem<a href="#accessing-the-filesystem" class="hash-link" aria-label="Direct link to Accessing the filesystem" title="Direct link to Accessing the filesystem">​</a></h2><p>This can be useful for dynamically configuring volume mounts for all the sub directories of the <code>node_modules</code> in your project.</p><p>The module is can be imported like so:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;filesystem.star&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="file-object-attributes">File object attributes<a href="#file-object-attributes" class="hash-link" aria-label="Direct link to File object attributes" title="Direct link to File object attributes">​</a></h3><p>The <code>fs.File</code> object attributes:</p><ul><li><code>is_dir</code>: <code>True</code> if the file is a directory</li><li><code>exists</code>: <code>True</code> if the file exists</li><li><code>name</code>: The last element of the file path</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="file-object-methods">File object methods<a href="#file-object-methods" class="hash-link" aria-label="Direct link to File object methods" title="Direct link to File object methods">​</a></h3><p>The <code>fs.File</code> object methods:</p><ul><li><code>list_dir()</code>: Returns a list of <code>fs.File</code> under the current directory, returns an error if not a directory</li><li><code>read_text()</code>: Returns the content of the file encoded in UTF-8</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="listing-files-under-a-directory">Listing files under a directory<a href="#listing-files-under-a-directory" class="hash-link" aria-label="Direct link to Listing files under a directory" title="Direct link to Listing files under a directory">​</a></h3><p>Example: print all the files under a directory</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;filesystem.star&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">iter_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">list_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">files_in_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">f </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> f </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">list_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_dir</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iter_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./node_modules&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iter_dir</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clone_repo_branch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;git@rafttio@github.com/another&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;trunk&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./node_modules&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Accessing dir in another repository</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="reading-files">Reading files<a href="#reading-files" class="hash-link" aria-label="Direct link to Reading files" title="Direct link to Reading files">​</a></h3><p>Example for reading a file</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;filesystem.star&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Read file as text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;requirements.txt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_text</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># OUT:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> fire</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0.4</span><span class="token number" style="color:#36acaa">.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Mako</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1.2</span><span class="token number" style="color:#36acaa">.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boto3</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1.24</span><span class="token number" style="color:#36acaa">.96</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">botocore</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1.27</span><span class="token number" style="color:#36acaa">.96</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">semver</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">2.13</span><span class="token number" style="color:#36acaa">.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configuring-credential-helpers">Configuring credential helpers<a href="#configuring-credential-helpers" class="hash-link" aria-label="Direct link to Configuring credential helpers" title="Direct link to Configuring credential helpers">​</a></h2><p>Raftt allow to configure credential helpers to allow the deployment of workloads with images from private registries.
Raftt will use the credential helpers to get the permissions from the cluster node without requiring extra permissions.
The credential helpers are configured using the <code>configure_cred_helper</code> function.</p><p>Supported credential helpers are <code>&quot;gcp&quot;</code> and <code>&quot;ecr&quot; (aws)</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ecr-aws">ECR (AWS)<a href="#ecr-aws" class="hash-link" aria-label="Direct link to ECR (AWS)" title="Direct link to ECR (AWS)">​</a></h3><p>For clusters running on AWS the credential helper can be configured like so:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">configure_cred_helper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  provider</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;ecr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  registries</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MIRROR.INTERNAL.com&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The second argument to the function is one or more image registry hostnames for which we need the ECR credential helper.
When using the ECR credential helper one or more registries must be supplied.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="gcp">GCP<a href="#gcp" class="hash-link" aria-label="Direct link to GCP" title="Direct link to GCP">​</a></h3><p>For clusters running on google cloud the credential helper can be configured like so:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">configure_cred_helper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;gcp&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="embedding-the-raftt-cli">Embedding the raftt CLI<a href="#embedding-the-raftt-cli" class="hash-link" aria-label="Direct link to Embedding the raftt CLI" title="Direct link to Embedding the raftt CLI">​</a></h2><p>You can add the Raftt CLI to any workload to access the CLI commands like <code>status</code> or <code>restart</code>. See the full CLI reference <a href="/docs/cli_reference">here</a>.</p><p>To add the CLI to a workload use the <code>add_raftt_cli</code> function like so:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">resources </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> k8s_manifests</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./manifests.yml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deployments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;nginx&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_raftt_cli</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/config/raftt.yml"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">raftt.yml</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/config/dev_container"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Dev Container</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#what-is-a-raftt-file" class="table-of-contents__link toc-highlight">What is a <code>.raftt</code> File</a></li><li><a href="#configuring-the-raftt-file-in-rafttyml" class="table-of-contents__link toc-highlight">Configuring the <code>.raftt</code> File in <code>raftt.yml</code></a></li><li><a href="#when-is-the-raftt-file-evaluated" class="table-of-contents__link toc-highlight">When is the <code>.raftt</code> File Evaluated</a></li><li><a href="#the-deploy-function" class="table-of-contents__link toc-highlight">The <code>deploy()</code> Function</a></li></ul></li><li><a href="#data-types" class="table-of-contents__link toc-highlight">Data Types</a><ul><li><a href="#starlark-data-types" class="table-of-contents__link toc-highlight">Starlark Data Types</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#repoworkingtree" class="table-of-contents__link toc-highlight">RepoWorkingTree</a></li></ul></li><li><a href="#importing-resource-definitions" class="table-of-contents__link toc-highlight">Importing Resource Definitions</a><ul><li><a href="#import-a-docker-compose-file" class="table-of-contents__link toc-highlight">Import a Docker-compose File</a></li><li><a href="#import-kubernetes-manifests" class="table-of-contents__link toc-highlight">Import Kubernetes Manifests</a></li><li><a href="#import-helm-charts" class="table-of-contents__link toc-highlight">Import Helm Charts</a></li><li><a href="#import-kustomize-files" class="table-of-contents__link toc-highlight">Import Kustomize Files</a></li></ul></li><li><a href="#image-building" class="table-of-contents__link toc-highlight">Image Building</a><ul><li><a href="#using-base-images" class="table-of-contents__link toc-highlight">Using Base Images</a></li></ul></li><li><a href="#enhancing-and-modifying-the-resources" class="table-of-contents__link toc-highlight">Enhancing and Modifying the Resources</a><ul><li><a href="#modifying-the-environment-variables-of-a-workload" class="table-of-contents__link toc-highlight">Modifying the Environment Variables of a Workload</a></li><li><a href="#setting-secrets" class="table-of-contents__link toc-highlight">Setting Secrets</a></li><li><a href="#volumes-and-mounts" class="table-of-contents__link toc-highlight">Volumes and Mounts</a></li><li><a href="#port-mapping" class="table-of-contents__link toc-highlight">Port Mapping</a></li><li><a href="#initializing-databases" class="table-of-contents__link toc-highlight">Initializing Databases</a></li><li><a href="#directly-modifying-resources" class="table-of-contents__link toc-highlight">Directly Modifying Resources</a></li><li><a href="#defining-the-dev-container" class="table-of-contents__link toc-highlight">Defining the <code>dev</code> container</a></li></ul></li><li><a href="#troubleshooting-the-raftt-file" class="table-of-contents__link toc-highlight">Troubleshooting the <code>.raftt</code> File</a><ul><li><a href="#viewing-the-resources-expected-to-be-deployed" class="table-of-contents__link toc-highlight">Viewing the Resources Expected to be Deployed</a></li></ul></li><li><a href="#multi-repo-support" class="table-of-contents__link toc-highlight">Multi-repo Support</a><ul><li><a href="#cloning-secondary-repositories" class="table-of-contents__link toc-highlight">Cloning Secondary Repositories</a></li><li><a href="#access-an-already-cloned-repo" class="table-of-contents__link toc-highlight">Access an Already-cloned Repo</a></li><li><a href="#deploy-the-raftt-file-of-a-secondary-repo" class="table-of-contents__link toc-highlight">Deploy the <code>.raftt</code> File of a Secondary Repo</a></li><li><a href="#raftt-sync-command" class="table-of-contents__link toc-highlight"><code>raftt sync</code> command</a></li></ul></li><li><a href="#local-configuration" class="table-of-contents__link toc-highlight">Local Configuration</a><ul><li><a href="#accessing-the-local-environment-variables" class="table-of-contents__link toc-highlight">Accessing the Local Environment Variables</a></li><li><a href="#arguments" class="table-of-contents__link toc-highlight">Arguments</a></li></ul></li><li><a href="#jsonyaml-encodingdecoding" class="table-of-contents__link toc-highlight">JSON/YAML Encoding/Decoding</a></li><li><a href="#file-watching" class="table-of-contents__link toc-highlight">File Watching</a><ul><li><a href="#example-file" class="table-of-contents__link toc-highlight">Example file</a></li><li><a href="#changing-the-hooks" class="table-of-contents__link toc-highlight">Changing the Hooks</a></li><li><a href="#viewing-the-hook-mechanism-logs" class="table-of-contents__link toc-highlight">Viewing the Hook Mechanism Logs</a></li></ul></li><li><a href="#accessing-the-filesystem" class="table-of-contents__link toc-highlight">Accessing the filesystem</a><ul><li><a href="#file-object-attributes" class="table-of-contents__link toc-highlight">File object attributes</a></li><li><a href="#file-object-methods" class="table-of-contents__link toc-highlight">File object methods</a></li><li><a href="#listing-files-under-a-directory" class="table-of-contents__link toc-highlight">Listing files under a directory</a></li><li><a href="#reading-files" class="table-of-contents__link toc-highlight">Reading files</a></li></ul></li><li><a href="#configuring-credential-helpers" class="table-of-contents__link toc-highlight">Configuring credential helpers</a><ul><li><a href="#ecr-aws" class="table-of-contents__link toc-highlight">ECR (AWS)</a></li><li><a href="#gcp" class="table-of-contents__link toc-highlight">GCP</a></li></ul></li><li><a href="#embedding-the-raftt-cli" class="table-of-contents__link toc-highlight">Embedding the raftt CLI</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/basics/quickstart">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/cli_reference">CLI Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/rafttcommunity/shared_invite/zt-196nlb5ra-rYPWEqQF~ETdgx9aqWANnw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/rafttio" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"> </div><ul class="footer__items clean-list"></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Raftt. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3708cc20.js"></script>
<script src="/assets/js/main.8354005e.js"></script>
</body>
</html>